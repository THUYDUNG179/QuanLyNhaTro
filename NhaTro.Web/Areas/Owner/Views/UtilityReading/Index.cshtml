@model IEnumerable<NhaTro.Application.DTOs.UtilityReadingDto>

@{
    ViewData["Title"] = "Danh sách Phòng";
    Layout = "~/Areas/Owner/Views/Shared/_Layout.cshtml"; // Đảm bảo dùng OwnerLayout
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            Danh sách chỉ số điện nước
            @if (ViewBag.RoomName != null)
            {
                <span>cho phòng: <strong>@ViewBag.RoomName</strong></span>
            }
            else if (ViewBag.MotelName != null)
            {
                <span>cho nhà trọ: <strong>@ViewBag.MotelName</strong></span>
            }
        </h2>
        <div>
            @if (ViewBag.MotelId != null)
            {
                <a asp-action="Create" asp-route-motelId="@ViewBag.MotelId" class="btn btn-primary">Thêm chỉ số mới</a>
            }
            else
            {
                <a asp-action="Create" class="btn btn-primary">Thêm chỉ số mới</a>
            }
            <a asp-action="Index" asp-controller="Motel" class="btn btn-secondary">Quay lại danh sách nhà trọ</a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-info">Chưa có chỉ số điện nước nào được ghi nhận.</div>
    }
    else
    {
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Nhà trọ</th>
                    <th>Phòng</th>
                    <th>Mã tiện ích</th>
                    <th>Giá trị</th>
                    <th>Ngày đọc</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderByDescending(x => x.ReadingDate))
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.MotelName)</td>
                        <td>@Html.DisplayFor(modelItem => item.RoomName)</td>
                        <td>@Html.DisplayFor(modelItem => item.UtilityId)</td>
                        <td>@Html.DisplayFor(modelItem => item.ReadingValue)</td>
                        <td>@Html.DisplayFor(modelItem => item.ReadingDate)</td>
                        <td>
                            <a asp-action="Details" asp-route-id="@item.ReadingId" class="btn btn-sm btn-info">Chi tiết</a>
                            <a asp-action="Edit" asp-route-id="@item.ReadingId" class="btn btn-sm btn-warning">Sửa</a>
							<form asp-action="Delete" asp-route-id="@item.ReadingId" method="post" class="d-inline" onsubmit="return confirm('Bạn có chắc muốn xóa chỉ số này?');">
								@Html.AntiForgeryToken()
								<button type="submit" class="btn btn-sm btn-danger">Xóa</button>
							</form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>